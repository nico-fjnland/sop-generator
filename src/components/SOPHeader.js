import React, { useState, useEffect, useRef } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { supabase } from '../lib/supabase';

const SOPHeader = ({ title: initialTitle = 'SOP Überschrift', stand: initialStand = 'STAND 12/22', logo: initialLogo = null, onTitleChange, onStandChange, onLogoChange }) => {
  const { user } = useAuth();
  const [title, setTitle] = useState(initialTitle);
  const [stand, setStand] = useState(initialStand);
  const [isEditingTitle, setIsEditingTitle] = useState(false);
  const [isEditingStand, setIsEditingStand] = useState(false);
  const [logo, setLogo] = useState(initialLogo);
  const [companyLogo, setCompanyLogo] = useState(null);
  const titleInputRef = useRef(null);
  const standInputRef = useRef(null);
  const logoInputRef = useRef(null);

  // Load company logo from profile
  useEffect(() => {
    async function loadCompanyLogo() {
      if (!user) return;
      
      try {
        const { data, error } = await supabase
          .from('profiles')
          .select('company_logo')
          .eq('id', user.id)
          .single();
        
        if (error) {
          console.error('Error loading company logo:', error);
          return;
        }
        
        if (data && data.company_logo) {
          setCompanyLogo(data.company_logo);
        } else {
          setCompanyLogo(null);
        }
      } catch (error) {
        console.error('Error loading company logo:', error);
      }
    }
    
    loadCompanyLogo();
    
    // Set up real-time subscription for profile changes
    const channel = supabase
      .channel('profile-changes')
      .on(
        'postgres_changes',
        {
          event: 'UPDATE',
          schema: 'public',
          table: 'profiles',
          filter: `id=eq.${user?.id}`
        },
        (payload) => {
          if (payload.new && payload.new.company_logo !== undefined) {
            setCompanyLogo(payload.new.company_logo);
          }
        }
      )
      .subscribe();
    
    return () => {
      supabase.removeChannel(channel);
    };
  }, [user]);

  useEffect(() => {
    setTitle(initialTitle);
  }, [initialTitle]);

  useEffect(() => {
    setStand(initialStand);
  }, [initialStand]);

  useEffect(() => {
    setLogo(initialLogo);
  }, [initialLogo]);

  useEffect(() => {
    if (isEditingTitle && titleInputRef.current) {
      titleInputRef.current.focus();
      titleInputRef.current.select();
    }
  }, [isEditingTitle]);

  useEffect(() => {
    if (isEditingStand && standInputRef.current) {
      standInputRef.current.focus();
      standInputRef.current.select();
    }
  }, [isEditingStand]);

  const handleTitleBlur = () => {
    setIsEditingTitle(false);
    if (onTitleChange) {
      onTitleChange(title);
    }
  };

  const handleTitleKeyDown = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleTitleBlur();
    }
  };

  const handleStandBlur = () => {
    setIsEditingStand(false);
    if (onStandChange) {
      onStandChange(stand);
    }
  };

  const handleStandKeyDown = (e) => {
    if (e.key === 'Enter') {
      e.preventDefault();
      handleStandBlur();
    }
  };

  const handleLogoChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        const logoUrl = reader.result;
        setLogo(logoUrl);
        if (onLogoChange) {
          onLogoChange(logoUrl);
        }
        // Reset the input value to allow uploading the same file again
        if (logoInputRef.current) {
          logoInputRef.current.value = '';
        }
      };
      reader.readAsDataURL(file);
    }
  };

  return (
    <div className="sop-header mb-8 print:mb-6" style={{ 
      display: 'flex', 
      justifyContent: 'space-between', 
      alignItems: 'center',
      width: '100%',
      paddingTop: '14px',
      paddingBottom: '14px',
      paddingLeft: '14px',
      paddingRight: '14px',
      gap: '112px'
    }}>
      {/* Left side: Version and Title */}
      <div className="flex flex-col gap-0" style={{ flex: '1', minWidth: 0 }}>
        {/* Version */}
        <div className="flex items-center gap-1" style={{ 
          paddingRight: '139px',
          paddingLeft: '8px',
          width: '100%'
        }}>
          {/* Icon - visible in both editor and print */}
          <div className="no-print" style={{ width: '11px', height: '11px', flexShrink: 0 }}>
            <svg width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.5074 9.40876V6.47007H9.46308C9.75074 6.40489 10.0076 6.2445 10.1916 6.01518C10.3756 5.78586 10.4758 5.5012 10.4758 5.20785C10.4758 4.91449 10.3756 4.62983 10.1916 4.40051C10.0076 4.17119 9.75074 4.0108 9.46308 3.94562H6.5074V1.00693C6.44184 0.720913 6.28053 0.465496 6.04988 0.282558C5.81924 0.0996201 5.53289 0 5.23785 0C4.94281 0 4.65654 0.0996201 4.42589 0.282558C4.19525 0.465496 4.03394 0.720913 3.96838 1.00693V3.94562H1.0127C0.725032 4.0108 0.468181 4.17119 0.284188 4.40051C0.100195 4.62983 0 4.91449 0 5.20785C0 5.5012 0.100195 5.78586 0.284188 6.01518C0.468181 6.2445 0.725032 6.40489 1.0127 6.47007H3.96838V9.40876C4.03394 9.69478 4.19525 9.9502 4.42589 10.1331C4.65654 10.3161 4.94281 10.4157 5.23785 10.4157C5.53289 10.4157 5.81924 10.3161 6.04988 10.1331C6.28053 9.9502 6.44184 9.69478 6.5074 9.40876Z" fill="#3399FF"/>
            </svg>
          </div>
          {/* Icon for print */}
          <div className="hidden print:block" style={{ width: '11px', height: '11px', flexShrink: 0 }}>
            <svg width="11" height="11" viewBox="0 0 11 11" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6.5074 9.40876V6.47007H9.46308C9.75074 6.40489 10.0076 6.2445 10.1916 6.01518C10.3756 5.78586 10.4758 5.5012 10.4758 5.20785C10.4758 4.91449 10.3756 4.62983 10.1916 4.40051C10.0076 4.17119 9.75074 4.0108 9.46308 3.94562H6.5074V1.00693C6.44184 0.720913 6.28053 0.465496 6.04988 0.282558C5.81924 0.0996201 5.53289 0 5.23785 0C4.94281 0 4.65654 0.0996201 4.42589 0.282558C4.19525 0.465496 4.03394 0.720913 3.96838 1.00693V3.94562H1.0127C0.725032 4.0108 0.468181 4.17119 0.284188 4.40051C0.100195 4.62983 0 4.91449 0 5.20785C0 5.5012 0.100195 5.78586 0.284188 6.01518C0.468181 6.2445 0.725032 6.40489 1.0127 6.47007H3.96838V9.40876C4.03394 9.69478 4.19525 9.9502 4.42589 10.1331C4.65654 10.3161 4.94281 10.4157 5.23785 10.4157C5.53289 10.4157 5.81924 10.3161 6.04988 10.1331C6.28053 9.9502 6.44184 9.69478 6.5074 9.40876Z" fill="#3399FF"/>
            </svg>
          </div>
          {isEditingStand ? (
            <input
              ref={standInputRef}
              type="text"
              value={stand}
              onChange={(e) => setStand(e.target.value)}
              onBlur={handleStandBlur}
              onKeyDown={handleStandKeyDown}
              className="no-print"
              style={{ 
                fontFamily: "'Quicksand', sans-serif",
                fontWeight: 600,
                fontSize: '10px',
                color: '#003366',
                letterSpacing: '2px',
                textTransform: 'uppercase',
                lineHeight: '1',
                border: '1.5px solid #3399FF',
                borderRadius: '4px',
                padding: '2px 4px',
                background: 'white',
                outline: 'none',
                width: '120px'
              }}
            />
          ) : (
            <span 
              onClick={() => setIsEditingStand(true)}
              className="no-print cursor-text sop-header-editable"
              style={{ 
                fontFamily: "'Quicksand', sans-serif",
                fontWeight: 600,
                fontSize: '10px',
                color: '#003366',
                letterSpacing: '2px',
                textTransform: 'uppercase',
                lineHeight: '1',
                border: '1.5px solid transparent'
              }}
            >
              {stand}
            </span>
          )}
          {/* Static version for print */}
          <span 
            className="hidden print:inline"
            style={{ 
              fontFamily: "'Quicksand', sans-serif",
              fontWeight: 600,
              fontSize: '10px',
              color: '#003366',
              letterSpacing: '2px',
              textTransform: 'uppercase',
              lineHeight: '1'
            }}
          >
            {stand}
          </span>
        </div>
        
        {/* Title */}
        {isEditingTitle ? (
          <input
            ref={titleInputRef}
            type="text"
            value={title}
            onChange={(e) => setTitle(e.target.value)}
            onBlur={handleTitleBlur}
            onKeyDown={handleTitleKeyDown}
            className="no-print"
            style={{ 
              fontFamily: "'Roboto', sans-serif",
              fontWeight: 600,
              fontSize: '26px',
              color: '#003366',
              letterSpacing: '1.04px',
              textTransform: 'uppercase',
              lineHeight: '1.2',
              width: '100%',
              border: '1.5px solid #3399FF',
              borderRadius: '6px',
              padding: '4px 8px',
              background: 'white',
              outline: 'none'
            }}
          />
        ) : (
          <div 
            onClick={() => setIsEditingTitle(true)}
            className="no-print cursor-text sop-header-title-editable"
            style={{ 
              fontFamily: "'Roboto', sans-serif",
              fontWeight: 600,
              fontSize: '26px',
              color: '#003366',
              letterSpacing: '1.04px',
              textTransform: 'uppercase',
              lineHeight: '1.2',
              width: '100%',
              border: '1.5px solid transparent'
            }}
          >
            {title}
          </div>
        )}
        {/* Static version for print */}
        <div 
          className="hidden print:block"
          style={{ 
            fontFamily: "'Roboto', sans-serif",
            fontWeight: 600,
            fontSize: '26px',
            color: '#003366',
            letterSpacing: '1.04px',
            textTransform: 'uppercase',
            lineHeight: '1.2',
            width: '100%'
          }}
        >
          {title}
        </div>
      </div>

      {/* Right side: Logo */}
      <div className="flex items-center justify-end" style={{ 
        paddingLeft: '14px',
        flexShrink: 0
      }}>
        <div className="relative" style={{ width: '155.4px', height: '65.2px' }}>
          {/* Logo Upload Input (hidden) */}
          <input
            ref={logoInputRef}
            type="file"
            accept="image/*"
            onChange={handleLogoChange}
            className="hidden"
            id="logo-upload"
          />
          
          {/* Logo Display */}
          <div 
            onClick={() => !companyLogo && logoInputRef.current?.click()}
            className="no-print sop-header-logo-editable"
            style={{ 
              width: '100%', 
              height: '100%',
              display: 'flex',
              alignItems: 'center',
              justifyContent: 'flex-end',
              border: '1.5px solid transparent',
              cursor: companyLogo ? 'default' : 'pointer'
            }}
            title={companyLogo ? 'Firmenlogo (im Profil festgelegt)' : 'Klicken Sie, um das Logo zu ändern'}
          >
            {companyLogo ? (
              <img 
                src={companyLogo} 
                alt="Firmenlogo" 
                style={{ 
                  maxWidth: '100%', 
                  height: '49.2px', 
                  width: 'auto',
                  objectFit: 'contain',
                  objectPosition: 'right center'
                }} 
              />
            ) : logo ? (
              <img 
                src={logo} 
                alt="Logo" 
                style={{ 
                  maxWidth: '100%', 
                  height: '49.2px', 
                  width: 'auto',
                  objectFit: 'contain',
                  objectPosition: 'right center'
                }} 
              />
            ) : (
              <svg width="87.6" height="49.2" viewBox="0 0 73 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M41.2725 3.93919C40.5137 2.83459 39.4482 1.97624 38.2073 1.46998C37.9705 1.37239 37.7132 1.33483 37.4583 1.36063C37.2035 1.38643 36.9589 1.47478 36.7464 1.61786C36.5313 1.76163 36.3549 1.95627 36.2329 2.18453C36.111 2.41279 36.0472 2.66762 36.0474 2.92641C36.0459 3.24975 36.1452 3.5655 36.3315 3.82975C36.5178 4.094 36.7819 4.29361 37.087 4.40076C37.7958 4.63523 38.4073 5.09692 38.827 5.71429C39.2467 6.33166 39.451 7.07023 39.4083 7.81552V14.7167C39.4271 15.2064 39.3439 15.6947 39.1642 16.1505C38.9845 16.6064 38.712 17.02 38.3642 17.3652C37.9492 17.729 37.4649 18.005 36.9404 18.1768C36.416 18.3485 35.8622 18.4124 35.3124 18.3645C34.3782 18.2875 33.5065 17.8643 32.8682 17.1778C32.2298 16.4914 31.8709 15.5913 31.8618 14.654V10.4147C31.8603 10.201 31.8146 9.98987 31.7274 9.79472C31.6403 9.59958 31.5136 9.42462 31.3554 9.28091C31.1964 9.13704 31.0089 9.02835 30.805 8.96194C30.6011 8.89553 30.3855 8.8729 30.1723 8.89552C29.7868 8.95014 29.4346 9.14386 29.182 9.44019C28.9294 9.73652 28.7939 10.115 28.801 10.5043V14.7257C28.801 16.5382 29.5211 18.2764 30.8027 19.5581C32.0843 20.8397 33.8226 21.5597 35.6351 21.5597C37.4475 21.5597 39.1858 20.8397 40.4674 19.5581C41.749 18.2764 42.4691 16.5382 42.4691 14.7257V7.78415C42.4685 6.41094 42.0513 5.07023 41.2725 3.93919Z" fill="#004D99"/>
                <path d="M20.2421 9.77832C19.3497 9.45111 18.5239 8.96529 17.8043 8.34429C17.5752 8.12882 17.3921 7.8693 17.2658 7.5813C17.1395 7.29329 17.0727 6.98274 17.0694 6.66828C17.0384 5.9841 17.2765 5.31497 17.7326 4.80405C17.9725 4.56466 18.26 4.37831 18.5765 4.25711C18.8931 4.13591 19.2315 4.08255 19.5699 4.10048C19.9327 4.08019 20.2952 4.14453 20.6289 4.28841C20.9625 4.43229 21.2582 4.65178 21.4924 4.92953C21.6959 5.19801 21.8479 5.5019 21.9405 5.82579C22.0534 6.1672 22.2718 6.46396 22.5641 6.67334C22.8564 6.88273 23.2077 6.99394 23.5673 6.99094C23.8578 6.98846 24.1435 6.91538 24.3995 6.77798C24.6556 6.64058 24.8744 6.44299 25.0371 6.20222C25.1902 5.97631 25.2844 5.71569 25.311 5.44409C25.3376 5.17248 25.2958 4.89854 25.1895 4.64721C25.1133 4.47243 25.0282 4.29318 24.9341 4.12289C24.4465 3.22678 23.7042 2.49538 22.801 2.02116C21.5896 1.42022 20.2345 1.16975 18.8884 1.29802C17.5422 1.4263 16.2588 1.92822 15.1827 2.74713C14.6224 3.22625 14.1774 3.82569 13.881 4.50075C13.5846 5.17581 13.4444 5.90908 13.4709 6.64587C13.4498 7.9224 13.8997 9.16197 14.7346 10.1279C15.5861 11.1182 17.0201 11.9966 18.9829 12.7405C19.8545 13.0433 20.6617 13.5069 21.3625 14.1073C21.61 14.382 21.7999 14.7036 21.9207 15.0531C22.0416 15.4026 22.091 15.7728 22.066 16.1418C22.066 17.773 21.2415 18.6379 19.6909 18.6379C18.5975 18.6379 17.7908 18.3466 17.2889 17.764C17.0158 17.4262 16.8228 17.0309 16.7243 16.6078C16.6281 16.2391 16.4121 15.9128 16.1104 15.68C15.8087 15.4473 15.4383 15.3212 15.0572 15.3217C14.7694 15.3241 14.4863 15.3958 14.232 15.5308C13.9778 15.6657 13.7597 15.8599 13.5963 16.097C13.4428 16.3137 13.3455 16.5652 13.3135 16.8288C13.2814 17.0925 13.3155 17.36 13.4126 17.6072C13.5364 17.908 13.6863 18.1974 13.8607 18.4721C14.4349 19.4214 15.2704 20.1853 16.2672 20.6724C17.338 21.1965 18.5168 21.4621 19.7089 21.4476C21.5507 21.4476 23.0295 20.9726 24.0916 20.0316C25.1537 19.0905 25.678 17.7909 25.678 16.1104C25.7313 14.7377 25.2784 13.3932 24.4053 12.3327C23.5628 11.3288 22.1601 10.4729 20.2421 9.77832Z" fill="#004D99"/>
                <path d="M57.1716 3.20898C56.0154 2.00351 54.438 1.39404 52.4841 1.39404H47.5099C47.0345 1.39404 46.5785 1.5829 46.2423 1.91906C45.9062 2.25522 45.7173 2.71116 45.7173 3.18657V19.6688C45.7173 20.1442 45.9062 20.6002 46.2423 20.9363C46.5785 21.2725 47.0345 21.4614 47.5099 21.4614H47.6264C48.1018 21.4614 48.5577 21.2725 48.8939 20.9363C49.23 20.6002 49.4189 20.1442 49.4189 19.6688V14.2196H52.4169C54.4559 14.2196 56.0692 13.6549 57.2075 12.5436C58.3457 11.4322 58.9283 9.88165 58.9283 7.95021C58.9922 6.19976 58.3606 4.49518 57.1716 3.20898ZM55.1998 7.97709C55.2559 8.83638 55.0085 9.68809 54.5007 10.3836C54.2516 10.6699 53.9406 10.8958 53.5912 11.0441C53.2418 11.1924 52.8632 11.2592 52.4841 11.2395H49.4055V4.37413H52.5424C52.929 4.37038 53.3107 4.46108 53.6543 4.63836C53.998 4.81564 54.2931 5.07413 54.5142 5.39138C55.0091 6.15966 55.249 7.06451 55.1998 7.97709Z" fill="#004D99"/>
                <path d="M34.1392 2.8279H32.2481V0.936784C32.2311 0.682728 32.1182 0.444632 31.9322 0.2707C31.7463 0.0967693 31.5011 0 31.2465 0C30.9919 0 30.7468 0.0967693 30.5608 0.2707C30.3749 0.444632 30.2619 0.682728 30.2449 0.936784V2.8279H28.3538C28.0998 2.8449 27.8617 2.95781 27.6877 3.14377C27.5138 3.32973 27.417 3.57484 27.417 3.82947C27.417 4.08409 27.5138 4.3292 27.6877 4.51516C27.8617 4.70112 28.0998 4.81404 28.3538 4.83105H30.2449V6.71768C30.2619 6.97173 30.3749 7.20983 30.5608 7.38376C30.7468 7.55769 30.9919 7.65446 31.2465 7.65446C31.5011 7.65446 31.7463 7.55769 31.9322 7.38376C32.1182 7.20983 32.2311 6.97173 32.2481 6.71768V4.83105H34.1392C34.3933 4.81404 34.6313 4.70112 34.8053 4.51516C34.9792 4.3292 35.076 4.08409 35.076 3.82947C35.076 3.57484 34.9792 3.32973 34.8053 3.14377C34.6313 2.95781 34.3933 2.8449 34.1392 2.8279Z" fill="#3399FF"/>
                <path d="M70.4687 29.38H1.7746C0.794512 29.38 0 30.1745 0 31.1546V39.2255C0 40.2055 0.794512 41.0001 1.7746 41.0001H70.4687C71.4488 41.0001 72.2433 40.2055 72.2433 39.2255V31.1546C72.2433 30.1745 71.4488 29.38 70.4687 29.38Z" fill="#3399FF"/>
                <path d="M8.11064 36.5138L6.64077 32.0504L6.62284 32.0011H5.78932L4.72276 38.1898H5.60558L6.38533 33.6995L7.86417 38.1898H8.69769L9.76873 32.0011H8.89487L8.11064 36.5138Z" fill="white"/>
                <path d="M14.9983 32.4092C14.8478 32.2499 14.6656 32.124 14.4633 32.0399C14.261 31.9557 14.0432 31.9151 13.8242 31.9207C13.5267 31.9037 13.2293 31.9545 12.9545 32.0694C12.6796 32.1843 12.4345 32.3603 12.2378 32.584C11.7824 33.1254 11.493 33.7867 11.4042 34.4885L11.2295 35.6178C11.204 35.8215 11.192 36.0266 11.1936 36.2318C11.1704 36.76 11.3285 37.2802 11.6418 37.7061C11.7912 37.8875 11.9796 38.0328 12.193 38.1314C12.4063 38.2299 12.6391 38.2791 12.8741 38.2752H12.9324C13.2175 38.2813 13.5007 38.2269 13.7633 38.1157C14.0259 38.0044 14.262 37.8389 14.456 37.6299C14.9081 37.0922 15.1959 36.4357 15.2851 35.7388L15.4643 34.5826C15.4914 34.3776 15.5049 34.171 15.5046 33.9642V33.7402C15.4898 33.2523 15.3114 32.7836 14.9983 32.4092ZM12.9817 37.4731H12.9324C12.7961 37.4769 12.6612 37.4444 12.5416 37.3791C12.4219 37.3138 12.3217 37.2179 12.2512 37.1012C12.0876 36.7743 12.0237 36.4065 12.0675 36.0436L12.0944 35.7075L12.2736 34.511C12.3305 34.0231 12.5161 33.5591 12.8114 33.1666C12.92 33.0344 13.057 32.9284 13.2121 32.8563C13.3673 32.7841 13.5366 32.7477 13.7076 32.7498H13.7704C13.9048 32.7445 14.0382 32.7749 14.157 32.8378C14.2759 32.9008 14.376 32.9941 14.4471 33.1083C14.6164 33.4333 14.6821 33.8024 14.6353 34.1659L14.595 34.5647L14.4022 35.8329C14.2185 36.9264 13.7345 37.4731 12.9817 37.4731Z" fill="white"/>
                <path d="M17.4896 32.0011L17.3462 32.7898H18.8923L17.9557 38.1898H18.8385L19.7706 32.7898H21.3122L21.4556 32.0011H17.4896Z" fill="white"/>
                <path d="M24.3467 32.0011L21.3891 38.0912L21.3443 38.1898H22.2853L23.0158 36.6034H24.8935L25.0772 38.1898H25.9511L25.0907 32.0011H24.3467ZM24.7949 35.8192H23.3833L24.5081 33.3858L24.7949 35.8192Z" fill="white"/>
                <path d="M30.7371 36.3795C30.7018 36.7027 30.5581 37.0044 30.3293 37.2354C30.1051 37.4248 29.8153 37.5181 29.5227 37.4953C29.4252 37.5053 29.3267 37.4948 29.2335 37.4645C29.1403 37.4342 29.0545 37.3848 28.9815 37.3194C28.9085 37.254 28.85 37.1741 28.8097 37.0848C28.7694 36.9955 28.7482 36.8987 28.7474 36.8007C28.7296 36.6519 28.7296 36.5014 28.7474 36.3526L29.4824 32.0012H28.5861L27.8556 36.3257C27.8095 36.5711 27.8152 36.8234 27.8723 37.0665C27.9295 37.3096 28.0367 37.5381 28.1873 37.7373C28.3442 37.9173 28.5397 38.0596 28.7593 38.1535C28.9789 38.2474 29.2169 38.2905 29.4555 38.2795H29.5092C30.021 38.2921 30.5186 38.1113 30.9029 37.7732C31.2981 37.3928 31.5457 36.8847 31.602 36.3391L32.3414 31.9967H31.4452L30.7371 36.3795Z" fill="white"/>
                <path d="M33.3008 38.1898H34.1792L34.6407 35.5189H36.6215L36.7649 34.7302H34.7752L35.1158 32.7898H37.4326L37.5715 32.0011H34.3719L33.3008 38.1898Z" fill="white"/>
                <path d="M41.7175 36.5138L40.2476 32.0504L40.2342 32.0011H39.4007L38.3296 38.1898H39.2125L39.9922 33.6995L41.4755 38.1898H42.309L43.3801 32.0011H42.5017L41.7175 36.5138Z" fill="white"/>
                <path d="M47.085 32.0011L44.1273 38.0912L44.0825 38.1898H45.0191L45.7541 36.6034H47.6273L47.8154 38.1898H48.7117L47.8289 32.0011H47.085ZM47.5331 35.8192H46.1215L47.2508 33.3858L47.5331 35.8192Z" fill="white"/>
                <path d="M54.1298 34.6047H51.9026L52.3552 32.0011H51.4768L50.4058 38.1898H51.2841L51.7726 35.3935H53.9909L53.5069 38.1898H54.3852L55.4473 32.0818L55.4607 32.0011H54.5779L54.1298 34.6047Z" fill="white"/>
                <path d="M59.3688 36.7692L58.719 32.0011H57.6614L56.5903 38.1898H57.4687L57.881 35.8147L58.1678 33.8429L58.8131 38.1315L58.822 38.1898H59.4942L61.6049 33.9684L61.2464 35.7161L60.8162 38.1898H61.699L62.7611 32.0818L62.7746 32.0011H61.6766L59.3688 36.7692Z" fill="white"/>
                <path d="M68.0856 32.7898L68.229 32.0011H64.9666L63.8956 38.1898H67.1893L67.3327 37.4011H64.9083L65.2623 35.3935H67.3372L67.4717 34.6047H65.3923L65.7105 32.7898H68.0856Z" fill="white"/>
              </svg>
            )}
          </div>
          
          {/* Static logo for print */}
          <div className="hidden print:block" style={{ width: '100%', height: '100%' }}>
            {companyLogo ? (
              <img 
                src={companyLogo} 
                alt="Firmenlogo" 
                style={{ 
                  width: '100%', 
                  height: '100%', 
                  objectFit: 'contain',
                  objectPosition: 'right center'
                }} 
              />
            ) : logo ? (
              <img 
                src={logo} 
                alt="Logo" 
                style={{ 
                  width: '100%', 
                  height: '100%', 
                  objectFit: 'contain',
                  objectPosition: 'right center'
                }} 
              />
            ) : (
              <svg width="87.6" height="49.2" viewBox="0 0 73 41" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M41.2725 3.93919C40.5137 2.83459 39.4482 1.97624 38.2073 1.46998C37.9705 1.37239 37.7132 1.33483 37.4583 1.36063C37.2035 1.38643 36.9589 1.47478 36.7464 1.61786C36.5313 1.76163 36.3549 1.95627 36.2329 2.18453C36.111 2.41279 36.0472 2.66762 36.0474 2.92641C36.0459 3.24975 36.1452 3.5655 36.3315 3.82975C36.5178 4.094 36.7819 4.29361 37.087 4.40076C37.7958 4.63523 38.4073 5.09692 38.827 5.71429C39.2467 6.33166 39.451 7.07023 39.4083 7.81552V14.7167C39.4271 15.2064 39.3439 15.6947 39.1642 16.1505C38.9845 16.6064 38.712 17.02 38.3642 17.3652C37.9492 17.729 37.4649 18.005 36.9404 18.1768C36.416 18.3485 35.8622 18.4124 35.3124 18.3645C34.3782 18.2875 33.5065 17.8643 32.8682 17.1778C32.2298 16.4914 31.8709 15.5913 31.8618 14.654V10.4147C31.8603 10.201 31.8146 9.98987 31.7274 9.79472C31.6403 9.59958 31.5136 9.42462 31.3554 9.28091C31.1964 9.13704 31.0089 9.02835 30.805 8.96194C30.6011 8.89553 30.3855 8.8729 30.1723 8.89552C29.7868 8.95014 29.4346 9.14386 29.182 9.44019C28.9294 9.73652 28.7939 10.115 28.801 10.5043V14.7257C28.801 16.5382 29.5211 18.2764 30.8027 19.5581C32.0843 20.8397 33.8226 21.5597 35.6351 21.5597C37.4475 21.5597 39.1858 20.8397 40.4674 19.5581C41.749 18.2764 42.4691 16.5382 42.4691 14.7257V7.78415C42.4685 6.41094 42.0513 5.07023 41.2725 3.93919Z" fill="#004D99"/>
                <path d="M20.2421 9.77832C19.3497 9.45111 18.5239 8.96529 17.8043 8.34429C17.5752 8.12882 17.3921 7.8693 17.2658 7.5813C17.1395 7.29329 17.0727 6.98274 17.0694 6.66828C17.0384 5.9841 17.2765 5.31497 17.7326 4.80405C17.9725 4.56466 18.26 4.37831 18.5765 4.25711C18.8931 4.13591 19.2315 4.08255 19.5699 4.10048C19.9327 4.08019 20.2952 4.14453 20.6289 4.28841C20.9625 4.43229 21.2582 4.65178 21.4924 4.92953C21.6959 5.19801 21.8479 5.5019 21.9405 5.82579C22.0534 6.1672 22.2718 6.46396 22.5641 6.67334C22.8564 6.88273 23.2077 6.99394 23.5673 6.99094C23.8578 6.98846 24.1435 6.91538 24.3995 6.77798C24.6556 6.64058 24.8744 6.44299 25.0371 6.20222C25.1902 5.97631 25.2844 5.71569 25.311 5.44409C25.3376 5.17248 25.2958 4.89854 25.1895 4.64721C25.1133 4.47243 25.0282 4.29318 24.9341 4.12289C24.4465 3.22678 23.7042 2.49538 22.801 2.02116C21.5896 1.42022 20.2345 1.16975 18.8884 1.29802C17.5422 1.4263 16.2588 1.92822 15.1827 2.74713C14.6224 3.22625 14.1774 3.82569 13.881 4.50075C13.5846 5.17581 13.4444 5.90908 13.4709 6.64587C13.4498 7.9224 13.8997 9.16197 14.7346 10.1279C15.5861 11.1182 17.0201 11.9966 18.9829 12.7405C19.8545 13.0433 20.6617 13.5069 21.3625 14.1073C21.61 14.382 21.7999 14.7036 21.9207 15.0531C22.0416 15.4026 22.091 15.7728 22.066 16.1418C22.066 17.773 21.2415 18.6379 19.6909 18.6379C18.5975 18.6379 17.7908 18.3466 17.2889 17.764C17.0158 17.4262 16.8228 17.0309 16.7243 16.6078C16.6281 16.2391 16.4121 15.9128 16.1104 15.68C15.8087 15.4473 15.4383 15.3212 15.0572 15.3217C14.7694 15.3241 14.4863 15.3958 14.232 15.5308C13.9778 15.6657 13.7597 15.8599 13.5963 16.097C13.4428 16.3137 13.3455 16.5652 13.3135 16.8288C13.2814 17.0925 13.3155 17.36 13.4126 17.6072C13.5364 17.908 13.6863 18.1974 13.8607 18.4721C14.4349 19.4214 15.2704 20.1853 16.2672 20.6724C17.338 21.1965 18.5168 21.4621 19.7089 21.4476C21.5507 21.4476 23.0295 20.9726 24.0916 20.0316C25.1537 19.0905 25.678 17.7909 25.678 16.1104C25.7313 14.7377 25.2784 13.3932 24.4053 12.3327C23.5628 11.3288 22.1601 10.4729 20.2421 9.77832Z" fill="#004D99"/>
                <path d="M57.1716 3.20898C56.0154 2.00351 54.438 1.39404 52.4841 1.39404H47.5099C47.0345 1.39404 46.5785 1.5829 46.2423 1.91906C45.9062 2.25522 45.7173 2.71116 45.7173 3.18657V19.6688C45.7173 20.1442 45.9062 20.6002 46.2423 20.9363C46.5785 21.2725 47.0345 21.4614 47.5099 21.4614H47.6264C48.1018 21.4614 48.5577 21.2725 48.8939 20.9363C49.23 20.6002 49.4189 20.1442 49.4189 19.6688V14.2196H52.4169C54.4559 14.2196 56.0692 13.6549 57.2075 12.5436C58.3457 11.4322 58.9283 9.88165 58.9283 7.95021C58.9922 6.19976 58.3606 4.49518 57.1716 3.20898ZM55.1998 7.97709C55.2559 8.83638 55.0085 9.68809 54.5007 10.3836C54.2516 10.6699 53.9406 10.8958 53.5912 11.0441C53.2418 11.1924 52.8632 11.2592 52.4841 11.2395H49.4055V4.37413H52.5424C52.929 4.37038 53.3107 4.46108 53.6543 4.63836C53.998 4.81564 54.2931 5.07413 54.5142 5.39138C55.0091 6.15966 55.249 7.06451 55.1998 7.97709Z" fill="#004D99"/>
                <path d="M34.1392 2.8279H32.2481V0.936784C32.2311 0.682728 32.1182 0.444632 31.9322 0.2707C31.7463 0.0967693 31.5011 0 31.2465 0C30.9919 0 30.7468 0.0967693 30.5608 0.2707C30.3749 0.444632 30.2619 0.682728 30.2449 0.936784V2.8279H28.3538C28.0998 2.8449 27.8617 2.95781 27.6877 3.14377C27.5138 3.32973 27.417 3.57484 27.417 3.82947C27.417 4.08409 27.5138 4.3292 27.6877 4.51516C27.8617 4.70112 28.0998 4.81404 28.3538 4.83105H30.2449V6.71768C30.2619 6.97173 30.3749 7.20983 30.5608 7.38376C30.7468 7.55769 30.9919 7.65446 31.2465 7.65446C31.5011 7.65446 31.7463 7.55769 31.9322 7.38376C32.1182 7.20983 32.2311 6.97173 32.2481 6.71768V4.83105H34.1392C34.3933 4.81404 34.6313 4.70112 34.8053 4.51516C34.9792 4.3292 35.076 4.08409 35.076 3.82947C35.076 3.57484 34.9792 3.32973 34.8053 3.14377C34.6313 2.95781 34.3933 2.8449 34.1392 2.8279Z" fill="#3399FF"/>
                <path d="M70.4687 29.38H1.7746C0.794512 29.38 0 30.1745 0 31.1546V39.2255C0 40.2055 0.794512 41.0001 1.7746 41.0001H70.4687C71.4488 41.0001 72.2433 40.2055 72.2433 39.2255V31.1546C72.2433 30.1745 71.4488 29.38 70.4687 29.38Z" fill="#3399FF"/>
                <path d="M8.11064 36.5138L6.64077 32.0504L6.62284 32.0011H5.78932L4.72276 38.1898H5.60558L6.38533 33.6995L7.86417 38.1898H8.69769L9.76873 32.0011H8.89487L8.11064 36.5138Z" fill="white"/>
                <path d="M14.9983 32.4092C14.8478 32.2499 14.6656 32.124 14.4633 32.0399C14.261 31.9557 14.0432 31.9151 13.8242 31.9207C13.5267 31.9037 13.2293 31.9545 12.9545 32.0694C12.6796 32.1843 12.4345 32.3603 12.2378 32.584C11.7824 33.1254 11.493 33.7867 11.4042 34.4885L11.2295 35.6178C11.204 35.8215 11.192 36.0266 11.1936 36.2318C11.1704 36.76 11.3285 37.2802 11.6418 37.7061C11.7912 37.8875 11.9796 38.0328 12.193 38.1314C12.4063 38.2299 12.6391 38.2791 12.8741 38.2752H12.9324C13.2175 38.2813 13.5007 38.2269 13.7633 38.1157C14.0259 38.0044 14.262 37.8389 14.456 37.6299C14.9081 37.0922 15.1959 36.4357 15.2851 35.7388L15.4643 34.5826C15.4914 34.3776 15.5049 34.171 15.5046 33.9642V33.7402C15.4898 33.2523 15.3114 32.7836 14.9983 32.4092ZM12.9817 37.4731H12.9324C12.7961 37.4769 12.6612 37.4444 12.5416 37.3791C12.4219 37.3138 12.3217 37.2179 12.2512 37.1012C12.0876 36.7743 12.0237 36.4065 12.0675 36.0436L12.0944 35.7075L12.2736 34.511C12.3305 34.0231 12.5161 33.5591 12.8114 33.1666C12.92 33.0344 13.057 32.9284 13.2121 32.8563C13.3673 32.7841 13.5366 32.7477 13.7076 32.7498H13.7704C13.9048 32.7445 14.0382 32.7749 14.157 32.8378C14.2759 32.9008 14.376 32.9941 14.4471 33.1083C14.6164 33.4333 14.6821 33.8024 14.6353 34.1659L14.595 34.5647L14.4022 35.8329C14.2185 36.9264 13.7345 37.4731 12.9817 37.4731Z" fill="white"/>
                <path d="M17.4896 32.0011L17.3462 32.7898H18.8923L17.9557 38.1898H18.8385L19.7706 32.7898H21.3122L21.4556 32.0011H17.4896Z" fill="white"/>
                <path d="M24.3467 32.0011L21.3891 38.0912L21.3443 38.1898H22.2853L23.0158 36.6034H24.8935L25.0772 38.1898H25.9511L25.0907 32.0011H24.3467ZM24.7949 35.8192H23.3833L24.5081 33.3858L24.7949 35.8192Z" fill="white"/>
                <path d="M30.7371 36.3795C30.7018 36.7027 30.5581 37.0044 30.3293 37.2354C30.1051 37.4248 29.8153 37.5181 29.5227 37.4953C29.4252 37.5053 29.3267 37.4948 29.2335 37.4645C29.1403 37.4342 29.0545 37.3848 28.9815 37.3194C28.9085 37.254 28.85 37.1741 28.8097 37.0848C28.7694 36.9955 28.7482 36.8987 28.7474 36.8007C28.7296 36.6519 28.7296 36.5014 28.7474 36.3526L29.4824 32.0012H28.5861L27.8556 36.3257C27.8095 36.5711 27.8152 36.8234 27.8723 37.0665C27.9295 37.3096 28.0367 37.5381 28.1873 37.7373C28.3442 37.9173 28.5397 38.0596 28.7593 38.1535C28.9789 38.2474 29.2169 38.2905 29.4555 38.2795H29.5092C30.021 38.2921 30.5186 38.1113 30.9029 37.7732C31.2981 37.3928 31.5457 36.8847 31.602 36.3391L32.3414 31.9967H31.4452L30.7371 36.3795Z" fill="white"/>
                <path d="M33.3008 38.1898H34.1792L34.6407 35.5189H36.6215L36.7649 34.7302H34.7752L35.1158 32.7898H37.4326L37.5715 32.0011H34.3719L33.3008 38.1898Z" fill="white"/>
                <path d="M41.7175 36.5138L40.2476 32.0504L40.2342 32.0011H39.4007L38.3296 38.1898H39.2125L39.9922 33.6995L41.4755 38.1898H42.309L43.3801 32.0011H42.5017L41.7175 36.5138Z" fill="white"/>
                <path d="M47.085 32.0011L44.1273 38.0912L44.0825 38.1898H45.0191L45.7541 36.6034H47.6273L47.8154 38.1898H48.7117L47.8289 32.0011H47.085ZM47.5331 35.8192H46.1215L47.2508 33.3858L47.5331 35.8192Z" fill="white"/>
                <path d="M54.1298 34.6047H51.9026L52.3552 32.0011H51.4768L50.4058 38.1898H51.2841L51.7726 35.3935H53.9909L53.5069 38.1898H54.3852L55.4473 32.0818L55.4607 32.0011H54.5779L54.1298 34.6047Z" fill="white"/>
                <path d="M59.3688 36.7692L58.719 32.0011H57.6614L56.5903 38.1898H57.4687L57.881 35.8147L58.1678 33.8429L58.8131 38.1315L58.822 38.1898H59.4942L61.6049 33.9684L61.2464 35.7161L60.8162 38.1898H61.699L62.7611 32.0818L62.7746 32.0011H61.6766L59.3688 36.7692Z" fill="white"/>
                <path d="M68.0856 32.7898L68.229 32.0011H64.9666L63.8956 38.1898H67.1893L67.3327 37.4011H64.9083L65.2623 35.3935H67.3372L67.4717 34.6047H65.3923L65.7105 32.7898H68.0856Z" fill="white"/>
              </svg>
            )}
          </div>
        </div>
      </div>
    </div>
  );
};

export default SOPHeader;

